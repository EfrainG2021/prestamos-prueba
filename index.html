<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Préstamos - RENIEC/SUNAT</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>Sistema de Préstamos</h1>
      <p>Consultas en tiempo real a RENIEC y SUNAT</p>
    </header>

    <div class="main-content">
      <!-- Columna izquierda -->
      <div class="card">
        <h2>Verificación de Cliente</h2>

        <div class="query-type">
          <button class="query-btn active" onclick="cambiarTipoConsulta('dni')" id="btnDni">Consulta por DNI</button>
          <button class="query-btn" onclick="cambiarTipoConsulta('ruc')" id="btnRuc">Consulta por RUC</button>
        </div>

        <div id="dniSection">
          <div class="form-group">
            <label for="dni">Número de DNI:</label>
            <input type="text" id="dni" placeholder="Ingrese DNI (8 dígitos)" maxlength="8">
          </div>
        </div>

        <div id="rucSection" class="hidden">
          <div class="form-group">
            <label for="ruc">Número de RUC:</label>
            <input type="text" id="ruc" placeholder="Ingrese RUC (11 dígitos)" maxlength="11">
          </div>
        </div>

        <button class="btn" onclick="verificarCliente()" id="btnVerificar">
          <span id="btnText">Consultar en RENIEC/SUNAT</span>
          <span id="loadingSpinner" class="loading hidden"></span>
        </button>

        <div id="notification" class="notification hidden"></div>

        <div id="customerInfo" class="customer-info hidden">
          <h3>Información del Cliente</h3>
          <div class="info-item"><span class="info-label">Nombre/Razón Social:</span><span class="info-value" id="nombreCliente"></span></div>
          <div class="info-item"><span class="info-label">Documento:</span><span class="info-value" id="documentoCliente"></span></div>
          <div class="info-item"><span class="info-label">Tipo:</span><span class="info-value" id="tipoCliente"></span></div>
          <div class="info-item"><span class="info-label">Dirección:</span><span class="info-value" id="direccionCliente"></span></div>
          <div class="info-item"><span class="info-label">Estado:</span><span class="info-value" id="estadoCliente"></span></div>
        </div>

        <h2 style="margin-top: 30px;">Registrar Préstamo</h2>
        <div class="form-group">
          <label for="monto">Monto del Préstamo (S/):</label>
          <input type="number" id="monto" placeholder="Ingrese monto" min="0" step="0.01">
        </div>
        <div class="form-group">
          <label for="interes">Tasa de Interés (%):</label>
          <input type="number" id="interes" placeholder="Ingrese tasa de interés" min="0" step="0.1" value="5">
        </div>
        <div class="form-group">
          <label for="moraDiaria">Mora diaria (% sobre la cuota):</label>
          <input type="number" id="moraDiaria" placeholder="Ej: 0.05" step="0.01" min="0" value="0.05">
        </div>
        <div class="form-group">
          <label for="plazo">Plazo (meses):</label>
          <input type="number" id="plazo" placeholder="Ingrese plazo en meses" min="1" value="12">
        </div>
        <div class="form-group">
          <label for="fechaInicio">Fecha de Desembolso:</label>
          <input type="date" id="fechaInicio">
        </div>
        <div class="form-group">
          <label for="analista">Analista de Crédito (opcional):</label>
          <input type="text" id="analista" placeholder="Ej: John Daniel Parimango">
        </div>
        <div class="form-group">
          <label for="caja">Caja (opcional):</label>
          <input type="text" id="caja" placeholder="Ej: 3">
        </div>

        <div id="interesCalculado" class="interest-calculation hidden">
          <h4>Cálculo de Interés</h4>
          <div class="info-item"><span class="info-label">Monto Prestado:</span><span class="info-value" id="montoPrestado"></span></div>
          <div class="info-item"><span class="info-label">Tasa de Interés:</span><span class="info-value" id="tasaInteres"></span></div>
          <div class="info-item"><span class="info-label">Interés Total:</span><span class="info-value" id="interesTotal"></span></div>
          <div class="info-item"><span class="info-label">Monto Total a Pagar:</span><span class="info-value" id="montoTotalPagar"></span></div>
        </div>

        <div id="fechaCalculada" class="date-info hidden">
          <h4>Información de Fechas</h4>
          <div class="info-item"><span class="info-label">Fecha de Desembolso:</span><span class="info-value" id="fechaDesembolsoMostrada"></span></div>
          <div class="info-item"><span class="info-label">Primera Cuota:</span><span class="info-value" id="fechaPrimeraCuotaMostrada"></span></div>
          <div class="info-item"><span class="info-label">Última Cuota:</span><span class="info-value" id="fechaUltimaCuotaMostrada"></span></div>
        </div>

        <div id="primeraCuota" class="first-payment hidden">
          <h4>Primera Cuota</h4>
          <div class="info-item"><span class="info-label">Fecha de Pago:</span><span class="info-value" id="fechaPrimeraCuota"></span></div>
          <div class="info-item"><span class="info-label">Monto de Cuota:</span><span class="info-value" id="montoPrimeraCuota"></span></div>
        </div>

        <button class="btn" onclick="registrarPrestamo()" id="btnRegistrar" disabled>Registrar Préstamo</button>
      </div>

      <!-- Columna derecha -->
      <div class="card">
        <h2>Préstamos Registrados</h2>
        <div class="stat-card">
          <h3 id="totalPrestamos">0</h3>
          <p>Total de Préstamos</p>
        </div>
        <div class="loans-list" id="loansList">
          <p id="noLoans">No hay préstamos registrados aún.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Cronograma -->
  <div id="cronogramaModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="cerrarModalCronograma()">&times;</button>

      <div class="cronograma-header"><h2>CRONOGRAMA DE PAGOS</h2></div>
      <div class="cronograma-info">
        <h3 id="cronogramaClienteModal"></h3>
        <p id="cronogramaDocumentoModal"></p>
        <p id="cronogramaDetallesModal"></p>
      </div>

      <table class="cronograma-table">
        <thead>
          <tr>
            <th>MES</th>
            <th>VENCIMIENTO</th>
            <th>AMORTIZACIÓN</th>
            <th>INTERÉS</th>
            <th>CUOTA</th>
            <th>SALDO</th>
          </tr>
        </thead>
        <tbody id="cronogramaBodyModal"></tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="2" style="text-align:right;padding-right:10px;">TOTAL:</td>
            <td id="totalAmortizacionModal">S/ 0.00</td>
            <td id="totalInteresModal">S/ 0.00</td>
            <td id="totalCuotaModal">S/ 0.00</td>
            <td id="saldoFinalModal">S/ 0.00</td>
          </tr>
        </tfoot>
      </table>

      <!-- Acciones principales -->
      <button class="print-cronograma-btn" onclick="imprimirCronogramaActual()">Imprimir Cronograma</button>
      <button class="print-cronograma-btn" onclick="compartirCronogramaPDF()">Compartir / Descargar PDF</button>

      <!-- Panel de pagos -->
      <div class="pay-panel">
        <h4>Registrar pago de la siguiente cuota</h4>
        <div class="pay-row">
          <div id="proximaInfoTexto">Próxima cuota: —</div>
          <input type="date" id="fechaPagoInput">
          <button class="print-cronograma-btn" onclick="registrarPagoCuotaSiguiente()">Registrar pago</button>
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
          <strong>Mora diaria (%):</strong>
          <input class="inline-input" type="number" id="moraEditableInput" step="0.01" min="0">
          <button class="mini-btn" onclick="actualizarMoraDiariaPrestamo()">Guardar mora</button>
        </div>

        <h4 style="margin-top:16px;">Historial de pagos</h4>
        <table class="table-mini">
          <thead>
            <tr>
              <th>Cuota</th>
              <th>Fecha de pago</th>
              <th>Mora cobrada</th>
              <th>Monto cuota</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="historialPagosBody">
            <tr><td colspan="5">Sin pagos aún.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Generación de PDF real -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>

  <script src="script.js"></script>
</body>
</html>
